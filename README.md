# Symfony Nuxt

Symfony Nuxt boilerplate.

## Setup

### Prerequisites

#### Linux

Install the latest version of [Docker](https://docs.docker.com/install/) and
[Docker Compose](https://docs.docker.com/compose/install/).

#### macOS

Consider installing [Vagrant](https://www.vagrantup.com/) and [VirtualBox](https://www.virtualbox.org/).

Indeed, Docker currently has substantial performance issues on macOS, and using Vagrant allows us to have an almost
Linux-like experience regarding performances.

#### Windows

Consider using a Linux-like terminal to run the [Makefile](Makefile) commands.
Vagrant might also be a solution regarding performances.

If not possible, you may also directly run the commands specified in the [Makefile](Makefile).
For instance, instead of running `make up`, run `docker-compose up -d`.

### Hosts

Update your `hosts` file with the following entries:

```
127.0.0.1   traefik.symfony-nuxt.localhost
127.0.0.1   symfony-nuxt.localhost
127.0.0.1   api.symfony-nuxt.localhost
127.0.0.1   phpmyadmin.symfony-nuxt.localhost
127.0.0.1   mailhog.symfony-nuxt.localhost
```

On Linux and macOS, run `sudo nano /etc/hosts` to edit it.

On Windows, edit the file `C:\Windows\System32\drivers\etc\hosts` with administrative privileges.

### SSH configuration

Update your SSH configuration with the following entry:

```
host code.mazars.global
    Hostname 52.169.52.102
    ForwardAgent yes
```

On Linux and macOS, run `sudo nano ~/.ssh/config` to edit it.

On Windows, edit the file `c:\Program Files\Git\etc\ssh\ssh_config` with administrative privileges.

Regarding the SSH key:

* It must **not** require a passphrase, since your project will need to pull dependencies from private repositories
  (`yarn` will not prompt for the passphrase but rather fail).

### First start

Copy the file [.env.dist](.env.dist) to a file named `.env`. For instance:

```
cp .env.dist .env
```

---

#### Vagrant user

"Comment" the `STARTUP_COMMAND_3` environment variable from the `api` service
in the [docker-compose.yml](docker-compose.yml) file.

Next, run:

```
docker-compose up webapp api
```

ðŸ“£&nbsp;&nbsp;This command starts the `webapp`, `api`, `hub` services. While booting, these services
install their JavaScript and PHP dependencies. We cannot do that directly in the Vagrant VM as `yarn` and
`composer install` may fail miserably the first time.

Once the services have installed the dependencies, you may stop them with:

```
CTRL+C
docker-compose down
```

Don't forget to uncomment the previous environment variable from the `api` service
in the [docker-compose.yml](docker-compose.yml) file.

Next, check there is no application running on port 80 (like Apache or another virtual machine).

If OK, run `make vagrant`, then `vagrant up`, and finally `vagrant ssh` to connect to the virtual machine.
From here, you'll be able to run all the next commands like Linux users!

---

Next, make sure there is no application running on port 80 (Vagrant users can skip this check).

Good? You may now start all the Docker containers with the following commands:

```
make up
```

It may take some time as each container will also set up itself, such as installing dependencies (PHP, JavaScript, etc.)
and compiling sources (JavaScript).

The containers will be ready faster next time you run this command as the first run is doing most of the setup.

Once everything is ready, the following endpoints should be available:

* http://traefik.symfony-nuxt.localhost (Reverse proxy, the entry point of all the HTTP requests)
* http://symfony-nuxt.localhost (Web application)
* http://api.symfony-nuxt.localhost (API)
* http://phpmyadmin.symfony-nuxt.localhost (phpMyAdmin, a web interface for your MySQL database)
* http://mailhog.symfony-nuxt.localhost (Emails catcher)

You may now initialize the databases...

```
make init-db
```

**~~Last but not least, start the message consumer with:~~**

> Not yet relevant, uncomment when emails/async tasks are a thing.

```
make consume
```

## What's next?

### Configuring Git

Git should ignore globally some folders like those generated by your IDE and Vagrant.

If not already done, you should tell Git where to find your global `.gitignore` file.

For instance, on Linux/macOS/Windows git bash:

```
git config --global core.excludesfile '~/.gitignore'
```

Windows cmd:

```
git config --global core.excludesfile "%USERPROFILE%\.gitignore"
```

Windows PowerShell:

```
git config --global core.excludesfile "$Env:USERPROFILE\.gitignore"
```

Then create the global `.gitignore` file according to the location specified previously.

You may now edit it, according to your environment, with:

```
# IDE
.idea
.vscode
# MacOS
.DS_Store
# Vagrant
.vagrant
```

### Documentation

### How to stop the stack?

As simple as the `make up` command, run `make down` to stop the entire Docker Compose stack.

If you're a Vagrant user, you may also stop the virtual machine with `vagrant halt`.

If you're not going to work on the project for a while, you may also destroy
the virtual machine using `vagrant destroy`.

### How to view the logs of the Docker containers?

All aggregated logs:

```
docker-compose logs -f
```

Logs of one service:

```
docker-compose logs -f SERVICE_NAME
```

For instance, if you want the logs of the `api` service:
```
docker-compose logs -f api
```
